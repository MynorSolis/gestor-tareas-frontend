<div class="modal-content p-4">
  <div class="modal-header border-0 pb-0 text-center">
    <img class="login-logo" src="assets/logo.png" alt="TaskApp">
    <h5 class="modal-title login-title">Cambiar contraseña</h5>
    <p class="login-subtitle">Restablece tu contraseña para continuar</p>
    <button type="button" class="btn-close" (click)="closeModal.emit()" aria-label="Close"></button>
  </div>
  
  <div class="modal-body px-3">
    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" novalidate class="login-form">
     
      <div class="form-group mb-4">
        <label for="username" class="form-label">Nombre de usuario</label>
        <input 
          id="username"
          type="text" 
          class="form-control input-field" 
          formControlName="username"
          placeholder="Ingresa tu nombre de usuario"
          [class.is-invalid]="passwordForm.get('username')?.invalid && passwordForm.get('username')?.touched">
        <div *ngIf="passwordForm.get('username')?.invalid && passwordForm.get('username')?.touched" 
             class="form-error">
          <i class="bi bi-exclamation-circle"></i> Nombre de usuario requerido
        </div>
      </div>
      
    
      <div class="form-group mb-4">
        <div class="d-flex justify-content-between align-items-center">
          <label for="newPassword" class="form-label">Nueva contraseña</label>
          <small class="text-muted">Mínimo 6 caracteres</small>
        </div>
        <div class="password-input">
          <input 
            id="newPassword"
            [type]="showPassword ? 'text' : 'password'" 
            class="form-control input-field" 
            formControlName="newPassword"
            placeholder="Ingresa tu nueva contraseña"
            [class.is-invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
          <button 
            class="password-toggle" 
            type="button"
            (click)="togglePasswordVisibility('password')"
            [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
            <i class="bi" [class.bi-eye]="!showPassword" [class.bi-eye-slash]="showPassword"></i>
          </button>
        </div>
        <div *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" 
             class="form-error">
          <div *ngIf="passwordForm.get('newPassword')?.errors?.['required']">
            <i class="bi bi-exclamation-circle"></i> Contraseña requerida
          </div>
          <div *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">
            <i class="bi bi-exclamation-circle"></i> La contraseña debe tener al menos 6 caracteres
          </div>
        </div>
      </div>

    
      <div class="form-group mb-4">
        <label for="confirmPassword" class="form-label">Confirmar contraseña</label>
        <div class="password-input">
          <input 
            id="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'" 
            class="form-control input-field" 
            formControlName="confirmPassword"
            placeholder="Repite tu nueva contraseña"
            [class.is-invalid]="(passwordForm.get('confirmPassword')?.invalid || passwordForm.errors?.['mismatch']) && passwordForm.get('confirmPassword')?.touched">
          <button 
            class="password-toggle" 
            type="button"
            (click)="togglePasswordVisibility('confirm')"
            [attr.aria-label]="showConfirmPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
            <i class="bi" [class.bi-eye]="!showConfirmPassword" [class.bi-eye-slash]="showConfirmPassword"></i>
          </button>
        </div>
        <div *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched" 
             class="form-error">
          <div *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">
            <i class="bi bi-exclamation-circle"></i> Confirmación de contraseña requerida
          </div>
        </div>
        <div *ngIf="passwordForm.errors?.['mismatch'] && passwordForm.get('confirmPassword')?.touched" 
             class="form-error">
          <i class="bi bi-exclamation-circle"></i> Las contraseñas no coinciden
        </div>
      </div>
      
      
      <div class="mt-5">
        <button 
          type="submit" 
          class="btn login-btn w-100 py-2"
          [disabled]="passwordForm.invalid || isLoading">
          <span *ngIf="!isLoading">Cambiar contraseña</span>
          <span *ngIf="isLoading">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Procesando...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>