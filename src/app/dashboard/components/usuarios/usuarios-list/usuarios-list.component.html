<div class="dashboard-container">

  <div class="dashboard-header">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="dashboard-title">Usuarios</h1>
        <p class="dashboard-subtitle">Administra los usuarios del sistema</p>
      </div>
      <button 
        *ngIf="authService.isAdmin()"
        [routerLink]="['/dashboard/usuarios/nuevo']"
        class="btn btn-primary d-flex align-items-center shadow-sm">
        <i-feather name="plus" class="feather-sm me-2"></i-feather>
        Nuevo Usuario
      </button>
    </div>
  </div>

  <div class="users-card">
    <div class="card-header">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="card-title">Lista de Usuarios</h2>
        <div class="text-muted small">
          Mostrando {{ getDisplayRange() }}
        </div>
      </div>
    </div>

    <div class="table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Email</th>
            <th>Rol</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="isLoading">
            <td colspan="4" class="text-center py-5">
              <div class="d-flex justify-content-center">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Cargando...</span>
                </div>
              </div>
            </td>
          </tr>
          
          <tr *ngFor="let usuario of usuariosPaginados" class="user-row">
            <td data-label="Usuario:">
              <div class="user-info">
                <div class="user-avatar">
                  <i-feather name="user" class="feather-sm"></i-feather>
                </div>
                <div>
                  <div class="user-name">{{ usuario.username }}</div>
                  <div class="user-join-date small text-muted">
                    Registrado el {{ usuario.fechaCreacion | date:'dd/MM/yyyy' }}
                  </div>
                </div>
              </div>
            </td>
            <td data-label="Email:">
              <div class="user-email">
                <i-feather name="mail" class="feather-xs me-1"></i-feather>
                {{ usuario.email }}
              </div>
            </td>
            <td data-label="Rol:">
              <div class="role-selector">
                <select 
                  [(ngModel)]="usuario.roles[0]" 
                  (change)="cambiarRolUsuario(usuario.id, usuario.roles[0])"
                  class="role-select"
                  [class.role-admin]="usuario.roles[0] === 'ROLE_ADMIN'"
                  [class.role-manager]="usuario.roles[0] === 'ROLE_ENCARGADO'"
                  [class.role-user]="usuario.roles[0] === 'ROLE_USER'">
                  <option value="ROLE_USER">Usuario Normal</option>
                  <option value="ROLE_ENCARGADO">Encargado</option>
                  <option value="ROLE_ADMIN">Administrador</option>
                </select>
              </div>
            </td>
            <td data-label="Acciones:" class="text-end">
              <div class="actions">
                <button 
                  (click)="eliminarUsuario(usuario.id, usuario.username)"
                  class="btn-action btn-delete tooltip-container">
                  <i-feather name="trash-2" class="feather-sm"></i-feather>
                  <span class="tooltip-text">Eliminar</span>
                </button>
              </div>
            </td>
          </tr>
          
          <tr *ngIf="!isLoading && usuarios.length === 0">
            <td colspan="4" class="text-center py-4">
              <div class="empty-state">
                <i-feather name="users" class="feather-lg mb-2"></i-feather>
                <p>No se encontraron usuarios</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>


    <div class="card-footer">
      <app-pagination 
        [currentPage]="currentPage"
        [itemsPerPage]="itemsPerPage"
        [totalItems]="usuarios.length"
        (pageChange)="onPageChange($event)">
      </app-pagination>
    </div>
  </div>
</div>